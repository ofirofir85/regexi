<html>
	<head>
		<title>Re(ge)xi</title>
		<link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.css')}}"/>
		<link rel="stylesheet" href="{{url_for('static',filename='css/app.css')}}"/>
		<link rel="shortcut icon" type="image/x-icon" href="{{url_for('static', filename='img/favicon.ico')}}" />
		<script type='text/javascript'>
			function reset_results(){
				document.getElementById('result_text').innerHTML = ''
				document.getElementById('result_summary').innerHTML = ''
				document.getElementById('result_summary').style.visibility = 'hidden'
				document.getElementById('result_text').style.visibility = 'hidden'
			}

			function check_regex(){
				reset_results()
				var pattern = document.getElementById('pattern');
				var text = document.getElementById('text_area');
				if (pattern.value != '' && text.value != ''){ //only when both fields are filled
					console.log('sending request pattern: ' + pattern.value + ' text: ' + text.value);
					var xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = function(){
						if (this.readyState == 4 && this.status == 200){ //when a valid response arrived
							console.log('recived response!')
							on_response(this.responseText) 
						}
					}
					var url = "{{url_for('check_regex')}}";
					xhttp.open('POST', url, true); //init the requests
					xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); //lets flask read the posted data as submitted form
					var post_string = 'pattern='+pattern.value+'&text=' + text.value; // post data
					xhttp.send(post_string); //send the ajax request
				}
			}

			function on_response(response){
				response = JSON.parse(response) //raw response given is a text(json formatted), this make it json obj.
				document.getElementById('result_summary').className = 'alert alert-'+response['result_type']
				document.getElementById('result_summary').style.visibility = 'visible'
				document.getElementById('result_summary').innerHTML = response['result_summary']
				document.getElementById('result_text').style.visibility = 'visible'
				document.getElementById('result_text').innerHTML = response['result_html']
			}
		</script>
	</head>
	<body>
		<table align='center' width='75%'>
			<tr>
				<td>
					<div class='media'>
						<div class='media-body'>
						<h1 class='display-1'>Re(ge)xi</h1>
						<h5 class='display-5'>By Ofir Barkay & Corona</h5>
						</div>
						<img class='img' src="{{url_for('static', filename='img/dog.png')}}"/>
					</div>
					<hr>
				</td>
			</tr>
			<tr>
				<td>
					<div class='input-group mb-3'>
						<div class='input-group-prepend'>
							<span class='input-group-text'>Pattern</span>
						</div>				
						<input type='text' class='form-control' id='pattern' placeholder="Regex Pattern" onkeyup="check_regex()"/>
					</div>
				</td>
			</tr>
			<tr>
				<td>
					<div class="input-group mb-3">
						<div class='input-group-prepend'>
							<span class='input-group-text'>Test Text</span>
						</div>
						<textarea id='text_area' placeholder='Text To Match Pattern Within' class='form-control' rows='3' onkeyup="check_regex()"></textarea>
					</div>
				</td>
			</tr>
			<tr>
				<td>
					<div id='result_summary' align="center" class='alert alert-primary' role='alert' style="visibility: hidden;">
					</div>
					<div class='shadow-sm p-3 mb-5 bg-white rounded' id='result_text'align="center
				" style="visibility: hidden;">
					</div>
				</td>
			</tr>
		</table>
	</body>
</html>